---
Title: "puppet mastering"
Description: "puppet mastering"
Tags: ["puppet"]
Date: "2011-12-03"
Categories:
  - "blog"
Slug: "puppetmastering"
---
<p>At my work, we're now really digging into using <a href="http://puppetlabs.com/" target="_blank">Puppet</a> - no longer just as a TechOps tools, but for our whole development cycle.</p><p>The hardest thing I've come across so far is in deploying Perl CPAN packages, although i have been using manifest/recipe i found here -<br /><a href="http://www.windley.com/archives/2008/10/using_puppet_and_cpan.shtml" target="_blank">http://www.windley.com/archives/2008/10/using_puppet_and_cpan.shtml</a></p><p>It had been working quite well, but now as we've been adding more and more to Puppet, I started seeing an error message:</p><p><strong>root@machine:~ $ puppet agent -test<br />err: Could not retrieve catalog from remote server: Could not intern from pson: expected value in object at &#8216;&#8221;i'!<br />warning: Not using cache on failed catalog<br />err: Could not retrieve catalog; skipping run</strong></p><p> - the error was intermittent and always slightly differently, making it quite hard to track down. I found a number of people running into similar problems on forums and mailing lists, but no satisfactory answers. </p><p>Aiiight, so the problem is due to the default HTTP server within Puppet, which is called <a href="http://en.wikipedia.org/wiki/WEBrick" target="_blank">WEBrick</a> - I didn't dig into why, but after having re-double-triple-checked my manifest syntax and having tried a million other solutions, i thought to switch out the webserver component to see what would happen (I wasn't being completely original here - any article which talks about scaling Puppet says that you have to move to using a different server).</p><p>Instructions for switching to Apache2/Passenger (mod_rails) are <a href="http://projects.puppetlabs.com/projects/puppet/wiki/Using_Passenger" target="_blank">here</a> - they're quite simple and it's easy to setup. </p>
